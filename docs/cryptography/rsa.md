---
title: 理解 RSA
description: RSA 的原理是什麼？
---

## RSA 是什麼？
RSA 是一種非對稱密碼的演算法  
由三個大佬共同發明，RSA 就是他們三位的姓氏首字  
RSA 應該是目前使用最廣泛的演算法之一  
你在 ssh 無密碼登入甚至是看網站時可能就不知不覺的使用到他  
今天我們來介紹他背後的原理！  
在那之前先來看一下本篇文章中會使用到的一些符號

* $m$  明文，也就是沒被加密過的文字
* $c$  密文，明文加密後  
* $(e, N)$ 公鑰，由 `e` 與 `N` 兩個數字組合而成
* $(d, N)$ 私鑰，由 `d` 與 `N` 兩個數字組合而成

gogo  \*\\(^o^)/\*

### 步驟

1. 找出兩個不同的質數 `p` 與 `q`，並算出 $p \times q = N$  
   這個 N 也就是上面公鑰私鑰裡面放的 N
2. 算出 $(p - 1)\times(q - 1)$ 的值，記為 $L$ 或是 $\phi(N)$
3. 找出一個小於 $L$ 且於 $L$ 互質的數字 $e$，這個 $e$ 就是公鑰裡的那個 $e$
4. 找出數字 $d$，使得 $d \times e \equiv 1$ $(mod \: N)$  
   這個 $d$ 就是私鑰裡的那個 $d$，上面的式子表示 $d \times e$ 在 mod $N$ 後會餘 1

我們有了公鑰與私鑰後就可以使用它們來加解密，方法非常簡單

> $c = m^e (mod \: N)$  **RSA加密**  
> $m = c^d (mod \: N)$  **RSA解密**
 
看到這邊你可能會想說 WTF，剛發生了什麼  
別擔心，我一開始也是 XD   
我們會在下一節帶過裡面使用到的魔 (數) 法 (學)  
當然都是以簡單講過為主，畢竟不是數學課

## 小積木

### 歐拉函數
歐拉函數記做 $\phi(N)$  
表示的是小於等於 $N$ 的正整數中有幾個與 $N$ 互質的數。  
比如說 $\phi(5)$ 就是 4，因為 1, 2, 3, 4 四個數字都與 5 互質  
這時候你就會發現若 $N$ 為質數，則 $\phi(N)$ 為 $(N - 1)$。  
歐拉函數還有一個乘積性的性質，若是兩個數 $p, q$ 互質  
則 $\phi(pq) = \phi(p) \times \phi(q)$  
:::info 舉例
為求簡單這邊以 3, 5 這兩個互質的數來當範例    
3 * 5 = 15，與 15 互質且比他小的整數有 1, 2, 4, 7, 8, 11, 13, 14 共 8 個  
$\phi(15) = \phi(3 \times 5) = \phi(3) \times \phi(5) = 2 \times 4$ 
:::
### 歐拉定理
歐拉定理說明如果兩數 $a, p$ 互質，則 $a^{\phi(p)} \equiv 1 (mod \: p)$
:::info 舉例
一樣用老朋友 3 跟 5，$3^{\phi(5)} = 3^4 = 81$  
$3^{\phi(5)} \equiv 1 (mod \: 5)$
:::

## 組裝
有了以上的積木，我們可以從頭來分析他每一步到底都在做什麼了  
* ### 為什麼需要 $(p - 1)$ 與 $(q - 1)$ 的相乘?  
  因為我們想到得到 $\phi(N)$，而 $N = pq$ 且 $p, q$ 為質數，
  因此 $\phi(N) = \phi(q) \times \phi(p) = (q - 1) \times (p - 1)$
* ### 為什麼需要 $\phi(N)$ ?  

  在 $m$ 與 $N$ 互質的情況下  
  我們知道 $m^{\phi(N)} \equiv 1 (mod \: N)$  
  如此只要我們能找到兩數 $d, e$ 相乘為 $k \times \phi(N) + 1$  
  就可以使用$d, e$ 搭配 $N$ 來加解密  
  因為 $m$ 的 $\phi(N)$ 次方都會變成 1   

<details>

<summary>註記</summary>

為求簡單，我省略了一些情況  
像是 $m$ 為任意訊息，可能不與 $N$ 互質。  
但我們可以透過其他方法如中國剩餘定理證明對任意的 $m$ 都成立。

</details>

* ### $d, e$ 一定有解嗎？
  還記得 $e$ 嗎  
  $e$ 是一個小於 $\phi(N)$ 且與他互質的整數  
  我們可以再套用一次歐拉定理  
  因為 $e$ 與 $\phi(N)$ 互質  
  因此 $e ^{\phi{\phi(N)}} \equiv 1 (mod \: \phi(N))$   
  我們可以看到 $d$ 可以是 $e^{\phi{\phi(N)} - 1}$  
  如此與 $e$ 相乘即為 $k \times \phi(N) + 1$  
  當然不只這組解，但一定存在  
* ### 所以他到底安全在哪？
  對壞人來說，已知的資訊只有公鑰 $(e, N)$  
  若想求得 $d$ 需要 $\phi(N)$ 的幫忙  
  $\phi(N)$ 是 $(p - 1) \times (q - 1)$  
  想知道 $\phi(N)$ 就需要 $p, q$  
  雖然我們有 $p \times q$ 的 $N$  
  但目前求質因數還是一個難題  
  因此很難求得 $p, q$。

## 結語  
原本還想放一點 source code 來體驗一下 
不然都是純文字好無聊  
但發現現在 linux 實作的版本跟最開始的這個已經不太一樣了 XD   
有緣的話再補上吧 (不會
明天還要上班 (;_;)